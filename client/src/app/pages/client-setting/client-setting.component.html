<app-page title="Client Profile">
    <form (ngSubmit)="submitClientForm()" class="space-y-6">
        <app-section title="Logo" subtitle="Used on invoices and client-facing materials.">
            <app-profile-picture-upload [maxSizeKb]="500" [title]="'Company Logo'"
                [subtitle]="'Square logo recommended for best results.'">
            </app-profile-picture-upload>
        </app-section>

        <app-section title="Client Type" subtitle="Tell us who the contract is for.">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="flex flex-col">
                    <app-select-input label="Client Type" name="clientType" [(ngModel)]="clientFormModel.clientType"
                        [options]="clientTypeOptions" placeholder="-- Select Type --" [required]="true"
                        (ngModelChange)="onClientTypeChange()"></app-select-input>
                </div>
            </div>
        </app-section>

        <app-section title="Client Details" subtitle="Legal details for contracting.">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="flex flex-col">
                    <app-base-input
                        [label]="clientFormModel.clientType === 'individual' ? 'Full Name' : 'Legal Entity Name'"
                        name="legalEntityName" [(ngModel)]="clientFormModel.legalEntityName" [required]="true"
                        [pattern]="clientFormModel.clientType === 'individual' ? '[a-zA-Z\\s]*' : ''"
                        [helperText]="clientFormModel.clientType === 'individual' ? 'Letters and spaces only' : ''">
                    </app-base-input>
                    <app-error-message [errorMessage]="clientErrors.legalEntityName"></app-error-message>
                </div>

                <div class="flex flex-col" *ngIf="clientFormModel.clientType === 'company'">
                    <app-base-input label="Industry / Business Sector" name="industry"
                        [(ngModel)]="clientFormModel.industry" [required]="true" pattern="[a-zA-Z\s]*"
                        helperText="Letters and spaces only">
                    </app-base-input>
                    <app-error-message [errorMessage]="clientErrors.industry"></app-error-message>
                </div>

                <div class="flex flex-col" *ngIf="clientFormModel.clientType === 'company'">
                    <app-base-input label="Company Registration Number" name="companyRegistrationNumber"
                        [(ngModel)]="clientFormModel.companyRegistrationNumber" [required]="true">
                    </app-base-input>
                    <app-error-message [errorMessage]="clientErrors.companyRegistrationNumber"></app-error-message>
                </div>

                <div class="flex flex-col" *ngIf="clientFormModel.clientType === 'company'">
                    <app-base-input label="Tax/VAT Number" name="taxVatNumber"
                        [(ngModel)]="clientFormModel.taxVatNumber">
                    </app-base-input>
                </div>

                <div class="flex flex-col" *ngIf="clientFormModel.clientType === 'company'">
                    <app-base-input label="Company Website (Optional)" name="companyWebsite" type="text"
                        [(ngModel)]="clientFormModel.companyWebsite">
                    </app-base-input>
                    <app-error-message [errorMessage]="clientErrors.companyWebsite"></app-error-message>
                </div>
            </div>
        </app-section>

        <app-section title="Primary Contact" subtitle="Who should receive coordination updates.">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="flex flex-col md:col-span-1">
                    <app-base-input label="Contact Name" name="primaryContactName"
                        [(ngModel)]="clientFormModel.primaryContact.name" [required]="true">
                    </app-base-input>
                    <app-error-message [errorMessage]="clientErrors.primaryContactName"></app-error-message>
                </div>

                <div class="flex flex-col md:col-span-1">
                    <app-base-input label="Contact Email" name="primaryContactEmail" type="email"
                        [(ngModel)]="clientFormModel.primaryContact.email" [required]="true">
                    </app-base-input>
                    <app-error-message [errorMessage]="clientErrors.primaryContactEmail"></app-error-message>
                </div>

                <div class="flex flex-col md:col-span-1">
                    <app-mobile-phone-input label="Mobile Phone" name="primaryContactMobile"
                        [(ngModel)]="clientFormModel.primaryContact.mobilePhone" [defaultCountry]="'CA'"
                        [disableCountrySelector]="true" helperText="Enter mobile number">
                    </app-mobile-phone-input>
                    <app-error-message [errorMessage]="clientErrors.primaryContactMobilePhone"></app-error-message>
                </div>

                <div class="flex flex-col md:col-span-1">
                    <app-landline-phone-input label="Landline Phone (Optional)" name="primaryContactLandline"
                        [(ngModel)]="clientFormModel.primaryContact.landlinePhone" [defaultCountry]="'CA'"
                        [disableCountrySelector]="true" helperText="Enter landline number">
                    </app-landline-phone-input>
                    <app-error-message [errorMessage]="clientErrors.primaryContactLandlinePhone"></app-error-message>
                </div>

                <div class="col-span-1 md:col-span-2" *ngIf="clientErrors.primaryContactPhoneNumbers">
                    <app-error-message [errorMessage]="clientErrors.primaryContactPhoneNumbers"></app-error-message>
                </div>
            </div>
        </app-section>

        <app-section title="Secondary Contact (Optional)" subtitle="Backup contact for urgent updates.">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="flex flex-col md:col-span-1">
                    <app-base-input label="Contact Name" name="secondaryContactName"
                        [(ngModel)]="clientFormModel.secondaryContact.name">
                    </app-base-input>
                    <app-error-message [errorMessage]="clientErrors.secondaryContactName"></app-error-message>
                </div>

                <div class="flex flex-col md:col-span-1">
                    <app-base-input label="Contact Email" name="secondaryContactEmail" type="email"
                        [(ngModel)]="clientFormModel.secondaryContact.email">
                    </app-base-input>
                    <app-error-message [errorMessage]="clientErrors.secondaryContactEmail"></app-error-message>
                </div>

                <div class="flex flex-col md:col-span-1">
                    <app-mobile-phone-input label="Mobile Phone" name="secondaryContactMobile"
                        [(ngModel)]="clientFormModel.secondaryContact.mobilePhone" [defaultCountry]="'CA'"
                        [disableCountrySelector]="true" helperText="Enter mobile number">
                    </app-mobile-phone-input>
                    <app-error-message [errorMessage]="clientErrors.secondaryContactMobilePhone"></app-error-message>
                </div>

                <div class="flex flex-col md:col-span-1">
                    <app-landline-phone-input label="Landline Phone (Optional)" name="secondaryContactLandline"
                        [(ngModel)]="clientFormModel.secondaryContact.landlinePhone" [defaultCountry]="'CA'"
                        [disableCountrySelector]="true" helperText="Enter landline number">
                    </app-landline-phone-input>
                    <app-error-message [errorMessage]="clientErrors.secondaryContactLandlinePhone"></app-error-message>
                </div>

                <div class="col-span-1 md:col-span-2" *ngIf="clientErrors.secondaryContactPhoneNumbers">
                    <app-error-message [errorMessage]="clientErrors.secondaryContactPhoneNumbers"></app-error-message>
                </div>
            </div>
        </app-section>

        <app-section title="Billing Address" subtitle="Appears on invoices and contracts.">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="flex flex-col">
                    <app-base-input label="Street Address" name="billingStreet"
                        [(ngModel)]="clientFormModel.billingAddress.street" [required]="true">
                    </app-base-input>
                    <app-error-message [errorMessage]="clientErrors.billingStreet"></app-error-message>
                </div>

                <div class="flex flex-col">
                    <app-base-input label="City" name="billingCity" [(ngModel)]="clientFormModel.billingAddress.city"
                        [required]="true">
                    </app-base-input>
                    <app-error-message [errorMessage]="clientErrors.billingCity"></app-error-message>
                </div>

                <div class="flex flex-col">
                    <app-select-input label="Country" name="billingCountry"
                        [(ngModel)]="clientFormModel.billingAddress.country" [options]="countryOptions"
                        placeholder="-- Select Country --" [required]="true" [searchable]="true"
                        [disabled]="true"></app-select-input>
                    <app-error-message [errorMessage]="clientErrors.billingCountry"></app-error-message>
                </div>

                <div class="flex flex-col" *ngIf="clientFormModel.billingAddress.country === 'CA'">
                    <app-select-input label="Province" name="billingProvince"
                        [(ngModel)]="clientFormModel.billingAddress.province" [options]="provinceOptions"
                        placeholder="-- Select Province --" [required]="true" [searchable]="true"></app-select-input>
                    <app-error-message [errorMessage]="clientErrors.billingProvince"></app-error-message>
                </div>

                <div class="flex flex-col">
                    <app-base-input label="Postal Code" name="billingPostalCode"
                        [(ngModel)]="clientFormModel.billingAddress.postalCode" [required]="true">
                    </app-base-input>
                    <app-error-message [errorMessage]="clientErrors.billingPostalCode"></app-error-message>
                </div>
            </div>
        </app-section>


        <div *ngIf="clientErrors.submit"
            class="rounded-lg border border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/40 p-4">
            <app-error-message [errorMessage]="clientErrors.submit"></app-error-message>
        </div>

        <app-sticky-action-bar [message]="'Save to activate your client profile.'" [containerClass]="'px-0'">
            <app-button *ngIf="!isEditMode" [label]="'Submit'" type="primary" [htmlType]="'submit'" [fullWidth]="true"
                size="lg" [customClass]="'w-full md:w-auto rounded-lg'">
            </app-button>
            <app-button *ngIf="isEditMode" [label]="'Save Changes'" type="success" [htmlType]="'submit'"
                [fullWidth]="true" size="lg" [customClass]="'w-full md:w-auto rounded-lg'">
            </app-button>
        </app-sticky-action-bar>
    </form>
</app-page>