<app-page title="Service Provider Profile">
    <form (ngSubmit)="submitProviderForm()" class="space-y-6">
        <app-section title="Company" subtitle="Core registration details.">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="flex flex-col">
                    <app-base-input label="Legal Company Name" name="legalCompanyName"
                        [(ngModel)]="providerFormModel.legalCompanyName" [required]="true">
                    </app-base-input>
                    <app-error-message [errorMessage]="providerErrors.legalCompanyName"></app-error-message>
                </div>

                <div class="flex flex-col">
                    <app-base-input label="Company Registration Number" name="companyRegistrationNumber"
                        [(ngModel)]="providerFormModel.companyRegistrationNumber" [required]="true">
                    </app-base-input>
                    <app-error-message [errorMessage]="providerErrors.companyRegistrationNumber"></app-error-message>
                </div>
            </div>
        </app-section>

        <app-section title="Contact & Branding" subtitle="How clients will reach and see you.">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="flex flex-col">
                    <app-base-input label="Company Phone" name="companyPhone" type="tel"
                        [(ngModel)]="providerFormModel.companyPhone" [required]="true">
                    </app-base-input>
                    <app-error-message [errorMessage]="providerErrors.companyPhone"></app-error-message>
                </div>

                <div class="flex flex-col">
                    <app-base-input label="Company Email" name="companyEmail" type="email"
                        [(ngModel)]="providerFormModel.companyEmail" [required]="true">
                    </app-base-input>
                    <app-error-message [errorMessage]="providerErrors.companyEmail"></app-error-message>
                </div>

                <div class="flex flex-col md:col-span-2">
                    <app-file-upload label="Upload Company Logo" name="companyLogo"
                        [(ngModel)]="providerFormModel.companyLogo" helperText="PNG, JPG, PDF up to 10MB"
                        [required]="false">
                    </app-file-upload>
                    <p class="text-xs text-gray-500 mt-2">Optional, recommended for proposals.</p>
                </div>
            </div>
        </app-section>

        <app-section title="Head Office Address" subtitle="Used for billing and compliance.">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="flex flex-col">
                    <app-base-input label="Street Address" name="officeStreet"
                        [(ngModel)]="providerFormModel.headOfficeAddress.street" [required]="true">
                    </app-base-input>
                    <app-error-message [errorMessage]="providerErrors.officeStreet"></app-error-message>
                </div>

                <div class="flex flex-col">
                    <app-base-input label="City" name="officeCity"
                        [(ngModel)]="providerFormModel.headOfficeAddress.city" [required]="true">
                    </app-base-input>
                    <app-error-message [errorMessage]="providerErrors.officeCity"></app-error-message>
                </div>

                <div class="flex flex-col">
                    <app-base-input label="Country" name="officeCountry"
                        [(ngModel)]="providerFormModel.headOfficeAddress.country" [required]="true">
                    </app-base-input>
                    <app-error-message [errorMessage]="providerErrors.officeCountry"></app-error-message>
                </div>

                <div class="flex flex-col">
                    <app-base-input label="Postal Code" name="officePostalCode"
                        [(ngModel)]="providerFormModel.headOfficeAddress.postalCode" [required]="true">
                    </app-base-input>
                    <app-error-message [errorMessage]="providerErrors.officePostalCode"></app-error-message>
                </div>
            </div>
        </app-section>

        <app-section title="Emergency Contact" subtitle="Who we can reach in case of emergency.">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                <div class="flex flex-col">
                    <app-base-input label="Emergency Contact Name" name="emergencyContactName"
                        [(ngModel)]="providerFormModel.emergencyContact.name" [required]="true">
                    </app-base-input>
                    <app-error-message [errorMessage]="providerErrors.emergencyContactName"></app-error-message>
                </div>

                <div class="flex flex-col">
                    <app-base-input label="Emergency Contact Email" name="emergencyContactEmail" type="email"
                        [(ngModel)]="providerFormModel.emergencyContact.email" [required]="true">
                    </app-base-input>
                    <app-error-message [errorMessage]="providerErrors.emergencyContactEmail"></app-error-message>
                </div>

                <div class="flex flex-col">
                    <app-base-input label="Emergency Mobile Phone" name="emergencyContactPhone" type="tel"
                        [(ngModel)]="providerFormModel.emergencyContact.phone" [required]="true">
                    </app-base-input>
                    <app-error-message [errorMessage]="providerErrors.emergencyContactPhone"></app-error-message>
                </div>

                <div class="flex flex-col">
                    <app-base-input label="Emergency Landline Phone" name="emergencyContactLandline" type="tel"
                        [(ngModel)]="providerFormModel.emergencyContact.landlinePhone" [required]="true">
                    </app-base-input>
                    <app-error-message [errorMessage]="providerErrors.emergencyContactLandline"></app-error-message>
                </div>

            </div>
        </app-section>

        <app-section title="Security License" subtitle="Must be active to deploy guards.">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="flex flex-col">
                    <app-base-input label="License Number" name="licenseNumber"
                        [(ngModel)]="providerFormModel.securityLicense.licenseNumber" [required]="true">
                    </app-base-input>
                    <app-error-message [errorMessage]="providerErrors.licenseNumber"></app-error-message>
                </div>

                <div class="flex flex-col">
                    <app-base-input label="Issuing Authority" name="issuingAuthority"
                        [(ngModel)]="providerFormModel.securityLicense.issuingAuthority" [required]="true">
                    </app-base-input>
                    <app-error-message [errorMessage]="providerErrors.issuingAuthority"></app-error-message>
                </div>

                <div class="flex flex-col">
                    <app-base-input label="Expiry Date" name="expiryDate" type="date"
                        [(ngModel)]="providerFormModel.securityLicense.expiryDate" [required]="true">
                    </app-base-input>
                    <app-error-message [errorMessage]="providerErrors.expiryDate"></app-error-message>
                </div>

                <div class="flex flex-col md:col-span-2">
                    <app-file-upload label="License Document" name="licenseDocument"
                        [(ngModel)]="providerFormModel.securityLicense.document" helperText="PNG, JPG, PDF up to 10MB"
                        [required]="false">
                    </app-file-upload>
                    <p class="text-xs text-gray-500 mt-2">Optional upload now avoids later holds.</p>
                </div>
            </div>
        </app-section>

        <app-section title="Operating Regions" subtitle="Start with primary jurisdictions.">
            <ng-container section-actions>
                <app-button [label]="'Add region'" type="outline" [htmlType]="'button'"
                    [customClass]="'hidden md:inline-flex rounded-lg'" (click)="addRegion()">
                </app-button>
            </ng-container>

            <div class="space-y-4">
                <div *ngFor="let region of providerFormModel.operatingRegions; let i = index trackBy: trackByIndex"
                    class="flex flex-col">
                    <app-base-input [label]="'Region ' + (i + 1)" [name]="'region' + i"
                        [(ngModel)]="providerFormModel.operatingRegions[i]" [required]="i === 0">
                    </app-base-input>
                </div>
                <app-error-message [errorMessage]="providerErrors.operatingRegions"></app-error-message>

                <app-button [label]="'Add another region'" type="outline" [htmlType]="'button'" [fullWidth]="true"
                    [customClass]="'md:hidden rounded-lg'" (click)="addRegion()">
                </app-button>
            </div>
        </app-section>

        <app-section title="Guard Categories Offered" subtitle="E.g., Patrol, Concierge, Event.">
            <ng-container section-actions>
                <app-button [label]="'Add category'" type="outline" [htmlType]="'button'"
                    [customClass]="'hidden md:inline-flex rounded-lg'" (click)="addCategory()">
                </app-button>
            </ng-container>

            <div class="space-y-4">
                <div *ngFor="let category of providerFormModel.guardCategoriesOffered; let i = index trackBy: trackByIndex"
                    class="flex flex-col">
                    <app-base-input [label]="'Category ' + (i + 1)" [name]="'category' + i"
                        [(ngModel)]="providerFormModel.guardCategoriesOffered[i]" [required]="i === 0">
                    </app-base-input>
                </div>
                <app-error-message [errorMessage]="providerErrors.guardCategories"></app-error-message>

                <app-button [label]="'Add another category'" type="outline" [htmlType]="'button'" [fullWidth]="true"
                    [customClass]="'md:hidden rounded-lg'" (click)="addCategory()">
                </app-button>
            </div>
        </app-section>

        <div *ngIf="providerErrors.submit"
            class="rounded-lg border border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/40 p-4">
            <app-error-message [errorMessage]="providerErrors.submit"></app-error-message>
        </div>

        <app-sticky-action-bar [message]="'Save to activate your provider profile.'" [containerClass]="'px-0'">
            <app-button *ngIf="!isEditMode" [label]="'Submit'" type="primary" [htmlType]="'submit'" [fullWidth]="true"
                size="lg" [customClass]="'w-full md:w-auto rounded-lg'">
            </app-button>
            <app-button *ngIf="isEditMode" [label]="'Save Changes'" type="success" [htmlType]="'submit'"
                [fullWidth]="true" size="lg" [customClass]="'w-full md:w-auto rounded-lg'">
            </app-button>
        </app-sticky-action-bar>
    </form>
</app-page>